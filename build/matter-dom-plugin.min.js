/*!
 * matter-dom-plugin 0.0.1 by Edgar Lopez-Garci 2017-07-02
 * https://github.com/elopezga/matter-dom-plugin
 * License MIT
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("matter-js")):"function"==typeof define&&define.amd?define(["matter-js"],t):"object"==typeof exports?exports.MatterDomPlugin=t(require("matter-js")):e.MatterDomPlugin=t(e.Matter)}(this,function(e){return function(e){function t(i){if(o[i])return o[i].exports;var n=o[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,i){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/libs",t(t.s=6)}([function(e,t,o){"use strict";var i={};e.exports=function(e){var t=e.Vertices,o=e.Vector,n=(e.Sleeping,e.Render,e.Common),r=e.Bounds,a=e.Axes,s=e.Body;e.Events;i=n.clone(s,!0),i.create=function(e){var o={id:n.nextId(),type:"body",label:"Dom Body",parts:[],plugin:{},angle:0,vertices:t.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:0},domRenderer:null,domBounds:null,domVertices:null},i=n.extend(o,e);return l(i,e),i},i.setVertices=function(e,o){o[0].body===e?e.vertices=o:e.vertices=t.create(o,e),e.axes=a.fromVertices(e.vertices),e.area=t.area(e.vertices),s.setMass(e,e.density*e.area);var i=t.centre(e.vertices);t.translate(e.vertices,i,-1),s.setInertia(e,s._inertiaScale*t.inertia(e.vertices,e.mass)),t.translate(e.vertices,e.position),r.update(e.bounds,e.vertices,e.velocity),e.domVertices=c(e),e.domBounds=u(e)},i.setPosition=function(e,i){var n=o.sub(i,e.position);e.positionPrev.x+=n.x,e.positionPrev.y+=n.y;for(var a=0;a<e.parts.length;a++){var s=e.parts[a];s.position.x+=n.x,s.position.y+=n.y,t.translate(s.vertices,n),r.update(s.bounds,s.vertices,e.velocity),e.domVertices=c(e),e.domBounds=u(e)}},i.setAngle=function(e,i){var n=i-e.angle;e.anglePrev+=n;for(var s=0;s<e.parts.length;s++){var l=e.parts[s];l.angle+=n,t.rotate(l.vertices,n,e.position),a.rotate(l.axes,n),r.update(l.bounds,l.vertices,e.velocity),e.domVertices=c(e),e.domBounds=u(e),s>0&&o.rotateAbout(l.position,n,e.position,l.position)}},i.scale=function(e,o,i,n){for(var l=0;l<e.parts.length;l++){var d=e.parts[l];t.scale(d.vertices,o,i,e.position),d.axes=a.fromVertices(d.vertices),e.isStatic||(d.area=t.area(d.vertices),s.setMass(d,e.density*d.area),t.translate(d.vertices,{x:-d.position.x,y:-d.position.y}),s.setInertia(d,t.inertia(d.vertices,d.mass)),t.translate(d.vertices,{x:d.position.x,y:d.position.y})),r.update(d.bounds,d.vertices,e.velocity),e.domVertices=c(e),e.domBounds=u(e)}if(e.circleRadius&&(o===i?e.circleRadius*=o:e.circleRadius=null),!e.isStatic){var p=_totalProperties(e);e.area=p.area,s.setMass(e,p.mass),s.setInertia(e,p.inertia)}},i.update=function(e,i,n,s){var l=Math.pow(i*n*e.timeScale,2),d=1-e.frictionAir*n*e.timeScale,p=e.position.x-e.positionPrev.x,m=e.position.y-e.positionPrev.y;e.velocity.x=p*d*s+e.force.x/e.mass*l,e.velocity.y=m*d*s+e.force.y/e.mass*l,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*d*s+e.torque/e.inertia*l,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=o.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var f=0;f<e.parts.length;f++){var y=e.parts[f];t.translate(y.vertices,e.velocity),f>0&&(y.position.x+=e.velocity.x,y.position.y+=e.velocity.y),0!==e.angularVelocity&&(t.rotate(y.vertices,e.angularVelocity,e.position),a.rotate(y.axes,e.angularVelocity),f>0&&o.rotateAbout(y.position,e.angularVelocity,e.position,y.position)),r.update(y.bounds,y.vertices,e.velocity),e.domVertices=c(e),e.domBounds=u(e)}};var l=function(e,i){i=i||{},s.set(e,{bounds:e.bounds||r.create(e.vertices),positionPrev:e.positionPrev||o.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),t.rotate(e.vertices,e.angle,e.position),a.rotate(e.axes,e.angle),r.update(e.bounds,e.vertices,e.velocity),e.domVertices=c(e),e.domBounds=u(e),s.set(e,{axes:i.axes||e.axes,area:i.area||e.area,mass:i.mass||e.mass,inertia:i.inertia||e.inertia});var l=e.isStatic?"#2e2b44":n.choose(["#006BA6","#0496FF","#FFBC42","#D81159","#8F2D56"]);e.render.fillStyle=e.render.fillStyle||l,e.render.strokeStyle=e.render.strokeStyle||"#000",e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)},c=function(e){var i=[],n=e.domRenderer;return e.vertices.forEach(function(e){var t=n.mapping.worldToView({x:e.x,y:e.y}),r=o.create(t.x,t.y);i.push(r)}),t.create(i,e)},u=function(e){return r.create(e.domVertices)};return i}},function(e,t,o){"use strict";var i={};e.exports=function(e){var t=(e.Vertices,e.Sleeping),o=e.Mouse,n=e.Events,r=(e.Detector,e.Constraint),a=e.Composite,s=e.Common,l=e.Bounds;i.create=function(e,t){var l=(e?e.mouse:null)||(t?t.mouse:null);l||(e&&e.render&&e.render.canvas?l=o.create(e.render.canvas):t&&t.element?l=o.create(t.element):(l=o.create(),s.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var u=r.create({label:"Mouse Constraint",pointA:l.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),d={type:"mouseConstraint",mouse:l,element:null,body:null,constraint:u,collisionFilter:{category:1,mask:4294967295,group:0}},p=s.extend(d,t);return n.on(e,"beforeUpdate",function(){var t=a.allBodies(e.world);i.update(p,t),c(p)}),p},i.update=function(e,o){var i,r=e.mouse,a=e.constraint,s=e.body;if(0===r.button)if(a.bodyB)t.set(a.bodyB,!1),i=s.domRenderer.mapping.viewToWorld(r.position),a.pointA=i;else for(var c=(document.querySelectorAll("[matter]"),0);c<o.length;c++){s=o[c],i=s.domRenderer.mapping.viewToWorld(r.position);s.domRenderer.mapping.worldToView(s.position);if(l.contains(s.bounds,i)){a.pointA=i,a.bodyB=e.body=s,a.pointB={x:0,y:0},a.angleB=s.angle;break}}else a.bodyB=e.body=null,a.pointB=null,s&&n.trigger(e,"enddrag",{mouse:r,body:s})};var c=function(e){var t=e.mouse,i=t.sourceEvents;i.mousemove&&n.trigger(e,"mousemove",{mouse:t}),i.mousedown&&n.trigger(e,"mousedown",{mouse:t}),i.mouseup&&n.trigger(e,"mouseup",{mouse:t}),o.clearSourceEvents(t)};return i}},function(e,t,o){"use strict";e.exports=function(e){var t=(e.World,e.Sleeping,e.Resolver,e.Render,e.Pair,e.Metrics,e.Grid,e.Events,e.Composite),o=(e.Constraint,e.Common,e.Body,e.DomBody),i=e.Engine,n=i.update;i.update=function(e,o,i){n(e,o,i),o=o||1e3/60,i=i||1;var a=e.world,s=e.timing,l=t.allBodies(a);return r(l,o,s.timeScale,i,a.bounds),e};var r=function(e,t,i,n,r){for(var a=0;a<e.length;a++){var s=e[a];s.isStatic||s.isSleeping||o.update(s,t,i,n)}}}},function(e,t,o){"use strict";var i={};e.exports=function(e){var t=(e.Body,e.DomBody),o=e.Vertices,n=e.Common,r=e.World;e.Bounds,e.Vector;return i.create=function(e){var t=e.bodyType,o=e.el,n=e.render,a=e.position;delete e.bodyType,delete e.el,delete e.render,delete e.position,e.domRenderer=n;var s=null,l=document.querySelector(o),c=n.mapping.viewToWorld({x:a.x,y:a.y});if("block"==t){var u=n.mapping.viewToWorld({x:l.offsetWidth,y:l.offsetHeight});s=i.block(c.x,c.y,u.x,u.y,e)}else if("circle"==t){var d=n.mapping.viewToWorld(l.offsetWidth/2);s=i.circle(c.x,c.y,d,e)}return s&&(console.log(s),l.setAttribute("matter-id",s.id),r.add(n.engine.world,[s])),s},i.block=function(e,i,r,a,s){var s=s||{},l={label:"Block Body",position:{x:e,y:i},vertices:o.fromPath("L 0 0 L "+r+" 0 L "+r+" "+a+" L 0 "+a)};if(s.chamfer){var c=option.chamfer;l.vertices=o.chamfer(l.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete s.chamfer}return t.create(n.extend({},l,s))},i.circle=function(e,t,o,r,a){r=r||{};var s={label:"Circle Body",circleRadius:o};a=a||25;var l=Math.ceil(Math.max(10,Math.min(a,o)));return l%2==1&&(l+=1),i.polygon(e,t,l,o,n.extend({},s,r))},i.polygon=function(e,i,r,a,s){if(s=s||{},r<3)return Bodies.circle(e,i,a,s);for(var l=2*Math.PI/r,c="",u=.5*l,d=0;d<r;d+=1){var p=u+d*l,m=Math.cos(p)*a,f=Math.sin(p)*a;c+="L "+m.toFixed(3)+" "+f.toFixed(3)+" "}var y={label:"Polygon Body",position:{x:e,y:i},vertices:o.fromPath(c)};if(s.chamfer){var g=s.chamfer;y.vertices=o.chamfer(y.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete s.chamfer}return t.create(n.extend({},y,s))},i}},function(e,t,o){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n={};e.exports=function(e){var t,o,r=e.Common,a=e.Composite,s=e.Events,l=e.Render;return"undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(r.now())},1e3/60)},o=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n.create=function(e){var t={engine:null,element:window,controller:n,frameRequestId:null,options:{}},o=e.engine,a=r.extend(t,e);a.mapping={},a.mapping.ratioMultiplier=1/6,a.mapping.VIEW={width:window.innerWidth,height:window.innerHeight},a.mapping.VIEW.center={x:a.mapping.VIEW.width/2,y:a.mapping.VIEW.height/2},a.mapping.WORLD={width:a.mapping.VIEW.width*a.mapping.ratioMultiplier,height:a.mapping.VIEW.height*a.mapping.ratioMultiplier},a.mapping.WORLD.center={x:a.mapping.WORLD.width/2,y:a.mapping.WORLD.height/2},a.mapping.viewToWorld=function(e){return"object"===(void 0===e?"undefined":i(e))&&null!==e?{x:a.mapping.ratioMultiplier*e.x,y:a.mapping.ratioMultiplier*e.y}:a.mapping.ratioMultiplier*e},a.mapping.worldToView=function(e){return"object"===(void 0===e?"undefined":i(e))&&null!==e?{x:e.x/a.mapping.ratioMultiplier,y:e.y/a.mapping.ratioMultiplier}:e/a.mapping.ratioMultiplier},document.querySelector("#debug").style.position="absolute";var s=l.create({element:document.querySelector("#debug"),engine:o,options:{width:a.mapping.WORLD.width,height:a.mapping.WORLD.height,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}});return l.run(s),a.DebugRender=s,a},n.run=function(e){!function o(i){e.frameRequestId=t(o),n.world(e)}()},n.stop=function(e){o(e.frameRequestId)},n.world=function(e){var t=e.engine,o=t.world,i=(a.allBodies(o),a.allConstraints(o),document.querySelectorAll("[matter]")),r={timestamp:t.timing.timestamp};s.trigger(e,"beforeRender",r),n.bodies(e,i)},n.bodies=function(e,t,o){for(var i,n=e.engine,r=n.world,s=(e.options,a.allBodies(r)),l=0;l<t.length;l++){i=t[l];for(var c=null,u=0;u<s.length;u++)if(i.hasAttribute("matter-id")&&s[u].id==i.getAttribute("matter-id")){c=s[u];break}if(c){var d=e.mapping.worldToView({x:c.position.x,y:c.position.y}),p={x:i.offsetWidth/2,y:i.offsetHeight/2};i.style.position="absolute",i.style.transform="translate("+(d.x-p.x)+"px, "+(d.y-p.y)+"px)",i.style.transform+="rotate("+c.angle+"rad)"}}},n}},function(t,o){t.exports=e},function(e,t,o){"use strict";var i=o(5),n=o(4),r=o(0),a=o(3),s=o(1),l=o(2),c={name:"matter-dom-plugin",version:"0.0.1",for:"matter-js@^0.12.0",install:function(e){c.installRenderDom(e),c.installDomBody(e),c.installDomBodies(e),c.installDomMouseConstraint(e),c.installEngine(e)},installRenderDom:function(e){console.log("Installing RenderDom module."),e.RenderDom=n(e)},installDomBodies:function(e){console.log("Installing DomBodies module."),e.DomBodies=a(e)},installDomMouseConstraint:function(e){console.log("Installing DomMouseConstraint."),e.DomMouseConstraint=s(e)},installDomBody:function(e){console.log("Installing DomBody updates."),e.DomBody=r(e)},installEngine:function(e){console.log("Patching Engine."),l(e)}};i.Plugin.register(c),e.exports.MatterDomPlugin=c}])});